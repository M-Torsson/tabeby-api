"""
Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠ: Ù…Ù‚Ø§Ø±Ù†Ø© Ø³Ù„ÙˆÙƒ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙŠØ¨Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØ§Ù„Ø°Ù‡Ø¨ÙŠØ©
"""
from fastapi.testclient import TestClient
from app.main import app
import os

os.environ['DOCTOR_PROFILE_SECRET'] = 'test-secret'

client = TestClient(app)
headers = {'Doctor-Secret': 'test-secret'}

clinic_id = 85

print("=" * 80)
print("ğŸ”¬ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù‚Ø§Ø±Ù†Ø©: Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© vs Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©")
print("=" * 80)

# ============================================================================
# Ø§Ù„Ù‚Ø³Ù… 1: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©
# ============================================================================
print("\n" + "ğŸŸ¡ " * 40)
print("ğŸ“Œ Ø§Ù„Ù‚Ø³Ù… 1: Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©")
print("ğŸŸ¡ " * 40)

# Ø¥Ù†Ø´Ø§Ø¡ ÙŠÙˆÙ…ÙŠÙ† Ø°Ù‡Ø¨ÙŠÙŠÙ†
print("\n1ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ ÙŠÙˆÙ…ÙŠÙ† Ø°Ù‡Ø¨ÙŠÙŠÙ†...")
create_golden = {
    "clinic_id": clinic_id,
    "days": {
        "2025-12-01": {
            "status": "active",
            "capacity_total": 5,
            "capacity_used": 2,
            "opening_time": "09:00",
            "closing_time": "17:00",
            "patients": [
                {"name": "Ù…Ø­Ù…Ø¯", "phone": "+9647001", "status": "active"},
                {"name": "ÙØ§Ø·Ù…Ø©", "phone": "+9647002", "status": "Ù…Ù„ØºÙ‰"}
            ]
        },
        "2025-12-02": {
            "status": "active",
            "capacity_total": 5,
            "capacity_used": 0,
            "opening_time": "09:00",
            "closing_time": "17:00",
            "patients": []
        }
    }
}
r1 = client.post('/api/create_golden_table', json=create_golden, headers=headers)
print(f"   STATUS: {r1.status_code} - {r1.json().get('message', '')}")

# Ø¹Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
r2 = client.get(f'/api/booking_golden_days?clinic_id={clinic_id}', headers=headers)
golden_before = len(r2.json().get('days', {}))
print(f"   Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©: {golden_before}")

# Ø¥ØºÙ„Ø§Ù‚ ÙŠÙˆÙ… Ø°Ù‡Ø¨ÙŠ ÙˆØ§Ø­Ø¯
print("\n2ï¸âƒ£ Ø¥ØºÙ„Ø§Ù‚ ÙŠÙˆÙ… Ø°Ù‡Ø¨ÙŠ ÙˆØ§Ø­Ø¯ (2025-12-01)...")
close_golden = {"clinic_id": clinic_id, "date": "2025-12-01"}
r3 = client.post('/api/close_table_gold', json=close_golden, headers=headers)
result_golden = r3.json()
print(f"   STATUS: {r3.status_code}")
print(f"   removed_all: {result_golden.get('removed_all')}")

# Ø¹Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
r4 = client.get(f'/api/booking_golden_days?clinic_id={clinic_id}', headers=headers)
if r4.status_code == 200:
    golden_after = len(r4.json().get('days', {}))
    print(f"   Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚: {golden_after}")
    print(f"   âœ… ØªÙ… Ø­Ø°Ù {golden_before - golden_after} ÙŠÙˆÙ…")
else:
    golden_after = 0
    print(f"   âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØ§Ù…Ù„Ø§Ù‹ ({golden_before} Ø£ÙŠØ§Ù…)")

# ============================================================================
# Ø§Ù„Ù‚Ø³Ù… 2: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©)
# ============================================================================
print("\n" + "ğŸ”µ " * 40)
print("ğŸ“Œ Ø§Ù„Ù‚Ø³Ù… 2: Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©)")
print("ğŸ”µ " * 40)

# Ø¥Ù†Ø´Ø§Ø¡ ÙŠÙˆÙ…ÙŠÙ† Ø¹Ø§Ø¯ÙŠÙŠÙ†
print("\n1ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ ÙŠÙˆÙ…ÙŠÙ† Ø¹Ø§Ø¯ÙŠÙŠÙ†...")
create_regular = {
    "clinic_id": clinic_id,
    "days": {
        "2025-12-01": {
            "status": "active",
            "capacity_total": 10,
            "capacity_used": 3,
            "patients": [
                {"name": "Ø£Ø­Ù…Ø¯", "phone": "+9647101"},
                {"name": "Ø³Ø§Ø±Ø©", "phone": "+9647102"},
                {"name": "Ø¹Ù„ÙŠ", "phone": "+9647103"}
            ]
        },
        "2025-12-02": {
            "status": "active",
            "capacity_total": 10,
            "capacity_used": 0,
            "patients": []
        }
    }
}
r5 = client.post('/api/create_table', json=create_regular, headers=headers)
print(f"   STATUS: {r5.status_code}")

# Ø¹Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
r6 = client.get(f'/api/booking_days?clinic_id={clinic_id}', headers=headers)
regular_before = len(r6.json().get('days', {}))
print(f"   Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©: {regular_before}")

# Ø¥ØºÙ„Ø§Ù‚ ÙŠÙˆÙ… Ø¹Ø§Ø¯ÙŠ ÙˆØ§Ø­Ø¯
print("\n2ï¸âƒ£ Ø¥ØºÙ„Ø§Ù‚ ÙŠÙˆÙ… Ø¹Ø§Ø¯ÙŠ ÙˆØ§Ø­Ø¯ (2025-12-01)...")
close_regular = {"clinic_id": clinic_id, "date": "2025-12-01"}
r7 = client.post('/api/close_table', json=close_regular, headers=headers)
result_regular = r7.json()
print(f"   STATUS: {r7.status_code}")
print(f"   removed_all: {result_regular.get('removed_all')}")

# Ø¹Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
r8 = client.get(f'/api/booking_days?clinic_id={clinic_id}', headers=headers)
if r8.status_code == 200:
    regular_after = len(r8.json().get('days', {}))
    print(f"   Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚: {regular_after}")
    print(f"   âœ… ØªÙ… Ø­Ø°Ù {regular_before - regular_after} ÙŠÙˆÙ…")
else:
    regular_after = 0
    print(f"   âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØ§Ù…Ù„Ø§Ù‹ ({regular_before} Ø£ÙŠØ§Ù…)")

# ============================================================================
# Ø§Ù„Ù‚Ø³Ù… 3: Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
# ============================================================================
print("\n" + "ğŸŸ¢ " * 40)
print("ğŸ“Š Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©")
print("ğŸŸ¢ " * 40)

print(f"""
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø§Ù„Ù†ÙˆØ¹                           â”‚ Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚  â”‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©               â”‚ {golden_before:^12} â”‚ {golden_after:^12} â”‚
â”‚ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©                â”‚ {regular_before:^12} â”‚ {regular_after:^12} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø§Ù„Ù†ÙˆØ¹                           â”‚ removed_all Ø¹Ù†Ø¯ Ø­Ø°Ù ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©               â”‚ {str(result_golden.get('removed_all')):^28} â”‚
â”‚ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©                â”‚ {str(result_regular.get('removed_all')):^28} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
""")

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø³Ù„ÙˆÙƒ
if result_golden.get('removed_all') == result_regular.get('removed_all'):
    print("âœ… Ø§Ù„Ø³Ù„ÙˆÙƒ Ù…ØªØ·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØ§Ù„Ø°Ù‡Ø¨ÙŠØ©!")
else:
    print("âš ï¸ ÙŠÙˆØ¬Ø¯ Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ø§Ù„Ø³Ù„ÙˆÙƒ!")

print("\n" + "=" * 80)
print("âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©")
print("=" * 80)
